@page "/"
@layout LandingLayout
@inject IJSRuntime JS
@rendermode InteractiveServer
@inject NavigationManager NavigationManager
@inject HomeTechBlazor.Components.Shared.CurrentUser CurrentUser

<Toast @ref="toastComponent" />

<!-- layout -->

<div class="page-wrapper">

    <!-- Navbar -->
    <nav class="navbar">
        <div class="container flex justify-between items-center">
            <!-- Logo + Text -->
            <div class="flex items-center">
                <img src="images/hometech.jpg" alt="Logo"
                     style="width:40px; height:40px; object-fit:contain; margin-right:8px;" />
                <h1 class="logo" style="margin:0; display:inline-block; line-height:40px;">
                    TECHFIX
                </h1>
            </div>

            <!-- Navigation Links -->
            <div class="nav-links flex items-center space-x-4">
                <a href="#home">Trang Chủ</a>
                <a href="#services">Dịch Vụ</a>
                <a href="#about">Về Chúng Tôi</a>
                <a href="#contact">Liên Hệ</a>
                <a href="/home">Trang Quản Trị</a>

                @if (CurrentUser.name != string.Empty)
                {
                    <p>Xin chào @Name</p>
                    <a href="/profile">Hồ sơ</a>
                    <a @onclick="SignOut">Đăng Xuất</a>
                }
                else
                {
                    <a href="/register">Đăng Ký</a>
                    <a href="/login">Đăng Nhập</a>
                }
            </div>
        </div>
    </nav>



    <section id="home" class="hero">
        <!-- Video nền -->
        <video autoplay muted loop playsinline class="hero-video">
            <source src="/videos/home.mp4" type="video/mp4" />
        </video>

        <!-- Lớp phủ tối -->
        <div class="hero-overlay"></div>

        <!-- Nội dung -->
        <div class="hero-content animate-fade-in">
            <h1 class="slide-down">TECHFIX – Giải Pháp Sửa Chữa & Dịch Vụ Toàn Diện</h1>
            <p class="slide-down delay-1">
                Từ ngôi nhà đến văn phòng, từ điện, nước, điện lạnh đến vệ sinh –
                TECHFIX mang đến dịch vụ nhanh chóng, uy tín và chuyên nghiệp
                cho mọi nhu cầu của bạn.
            </p>
            <div class="hero-actions slide-down delay-2">
                <a href="/book" class="btn-primary">Đặt Ngay</a>
                <a href="#about" class="btn-secondary">Tìm Hiểu Thêm</a>
            </div>
        </div>
    </section>




    <!-- Services -->
    <section id="services" class="section">
        <h2 class="section-title">Các Dịch Vụ TECHFIX</h2>
        <div class="slider-container">
            <div class="slider">
                <div class="slide-track" id="slideTrack">
                    <div class="slide">
                        <img src="images/car.jpg" alt="car">
                        <h3>Sửa Chữa & Bảo Trì Xe</h3>
                        <p>
                            Dịch vụ sửa chữa và bảo trì xe chuyên nghiệp, giúp phương tiện của bạn vận hành êm ái,
                            an toàn và tiết kiệm chi phí. Chúng tôi cam kết mang đến trải nghiệm nhanh chóng và tin cậy.
                        </p>
                    </div>
                    <div class="slide">
                        <img src="images/pcc.jpg" alt="Sửa Chữa Máy Tính">
                        <h3>Sửa Chữa Máy Tính</h3>
                        <p>
                            Sửa chữa máy tính từ phần cứng đến phần mềm, xử lý sự cố chậm, treo máy, hỏng hóc linh kiện.
                            Đội ngũ kỹ thuật viên tận tâm sẽ khôi phục hiệu năng tối ưu cho thiết bị của bạn.
                        </p>
                    </div>
                    <div class="slide">
                        <img src="images/elec.jpg" alt="Electrical">
                        <h3>Sửa chữa & bảo trì hệ thống điện</h3>
                        <p>
                            Dịch vụ điện dân dụng và công nghiệp toàn diện: sửa chữa, lắp đặt, bảo trì hệ thống điện.
                            Đảm bảo an toàn, ổn định và tiết kiệm điện năng cho gia đình cũng như doanh nghiệp.
                        </p>
                    </div>
                    <div class="slide">
                        <img src="images/air.jpg" alt="air-conditioned">
                        <h3>Sửa Chữa & Vệ Sinh Điện Lạnh</h3>
                        <p>
                            Vệ sinh, sửa chữa và bảo trì hệ thống điện lạnh định kỳ. Giúp máy lạnh, tủ lạnh hoạt động hiệu quả,
                            mang lại không gian trong lành, thoáng mát và nâng cao tuổi thọ thiết bị.
                        </p>
                    </div>
                </div>
            </div>
            <button class="control-btn" id="prevBtn">❮</button>
            <button class="control-btn" id="nextBtn">❯</button>
            <div class="pagination" id="pagination"></div>
        </div>
        <div class="more-btn-container" style="text-align: center; margin-top: 20px;">
            <a href="/ServicesT" class="more-btn">Tìm Hiểu Thêm</a>
        </div>
    </section>

    <!-- About -->
    <section id="about" class="section light">
        <h2 class="section-title">Giới Thiệu TECHFIX</h2>
        <div class="about-container">
            <img src="images/hometech.jpg" alt="HomeTech logo" />
            <div>
                <p>
                    TECHFIX là nền tảng dịch vụ gia đình hiện đại, kết nối khách
                    hàng với đội ngũ kỹ thuật viên uy tín và chuyên nghiệp.
                </p>
                <p>
                    Chỉ với vài thao tác đơn giản, bạn có thể dễ dàng đặt lịch sửa
                    chữa, bảo trì hay vệ sinh nhà cửa ngay tại nhà.
                </p>
                <p>
                    Với TECHFIX, chúng tôi mang đến trải nghiệm nhanh chóng,
                    minh bạch và an toàn – giúp bạn tận hưởng không gian sống tiện
                    nghi hơn mỗi ngày.
                </p>
            </div>
        </div>
    </section>

    <!-- Contact -->
    <section id="contact" class="section">
        <h2 class="section-title">Liên Hệ</h2>
        <form class="contact-form">
            <input type="text" placeholder="Tên của bạn" />
            <input type="email" placeholder="Email của bạn" />
            <textarea rows="5" placeholder="Gửi về chúng tôi..."></textarea>
            <button type="submit" class="btn-primary w-full">Gửi</button>
        </form>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div>
            <h3>TECHFIX</h3>
            <p>
                ĐẶT NIỀM TIN - TRAO CHỮ TÍN
            </p>
        </div>
        <div>
            <h3>Liên Kết Nhanh</h3>
            <a href="#services">Dịch Vụ</a> |
            <a href="#about">Về Chúng Tôi</a> |
            <a href="#contact">Liên Hệ</a>
        </div>
        <div>
            <h3>Thông Tin Liên Hệ</h3>
            <p>Email: support@techfix.com</p>
            <p>Phone: +84 123 456 789</p>
            <p>Address: P4 Phạm Thái Bường</p>
        </div>
        <p class="copy">© 2025 TECHFIX. All rights reserved.</p>
    </footer>
</div>


@code {
    private Toast toastComponent;
    private string? errorMessage;
    private string Name => CurrentUser.name;

    protected override void OnInitialized()
    {
        var uri = new Uri(NavigationManager.Uri);
        var query = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);

        if (query.TryGetValue("error", out var errorValue))
        {
            if (errorValue == "forbidden")
            {
                errorMessage = "Bạn không có quyền truy cập trang này";
            }
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            if (!string.IsNullOrEmpty(errorMessage))
            {
                toastComponent.ShowError(errorMessage);
                errorMessage = null;
            }

            // 👉 GỌI INIT SLIDER
            await JS.InvokeVoidAsync("landingPage.init");
        }
    }

    private void SignOut()
    {
        CurrentUser.name = string.Empty;
        CurrentUser.role = string.Empty;
        CurrentUser.id = 0;
        CurrentUser.phone = string.Empty;
        CurrentUser.address = string.Empty;
        NavigationManager.NavigateTo("/");
    }
}
